
> afrodita-backend@1.0.0 test
> jest

node.exe : FAIL src/modules/users/users.service.spec.ts (8.02 s)
строка:1 знак:1
+ & "D:\Program Files\nodejs/node.exe" "D:\Program Files\nodejs/node_mo ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (FAIL src/module...pec.ts (8.02 s):String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
  тЧП UsersService тА║ findAll - edge cases тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╤Д╨╕╨╗╤М╤В╤А╨╛╨▓╨░╤В╤М ╨┐╨╛╨╗╤М╨╖╨╛╨▓╨░╤В╨╡╨╗╨╡╨╣ ╨┐╨╛ search

    TypeError: query.andWhere is not a function

    [0m [90m 26 |[39m     }
     [90m 27 |[39m     [36mif[39m (search) {
    [31m[1m>[22m[39m[90m 28 |[39m       query[33m.[39mandWhere(
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m         [32m'(user.firstName ILIKE :search OR user.lastName ILIKE :search OR user.phone ILIKE :search OR user.email ILIKE :search)'[39m[33m,[39m
     [90m 30 |[39m         { search[33m:[39m [32m`%${search}%`[39m }[33m,[39m
     [90m 31 |[39m       )[33m;[39m[0m

      at UsersService.findAll (modules/users/users.service.ts:28:13)
      at Object.<anonymous> (modules/users/users.service.spec.ts:374:21)

  тЧП UsersService тА║ findAll - edge cases тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╤Д╨╕╨╗╤М╤В╤А╨╛╨▓╨░╤В╤М ╨┐╨╛╨╗╤М╨╖╨╛╨▓╨░╤В╨╡╨╗╨╡╨╣ ╨┐╨╛ isActive

    TypeError: query.getCount is not a function

    [0m [90m 33 |[39m     query[33m.[39morderBy([32m'user.createdAt'[39m[33m,[39m [32m'DESC'[39m)[33m;[39m
     [90m 34 |[39m
    [31m[1m>[22m[39m[90m 35 |[39m     [36mconst[39m total [33m=[39m [36mawait[39m query[33m.[39mgetCount()[33m;[39m
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 36 |[39m     [36mconst[39m skip [33m=[39m (page [33m-[39m [35m1[39m) [33m*[39m limit[33m;[39m
     [90m 37 |[39m     query[33m.[39mskip(skip)[33m.[39mtake(limit)[33m;[39m
     [90m 38 |[39m[0m

      at UsersService.findAll (modules/users/users.service.ts:35:31)
      at Object.<anonymous> (modules/users/users.service.spec.ts:390:21)

PASS src/modules/appointments/appointments.service.spec.ts (8.53 s)
PASS src/modules/masters/masters.controller.spec.ts (8.581 s)
PASS src/modules/auth/auth.controller.spec.ts (8.86 s)
PASS src/tasks/scheduler.service.spec.ts
[31m[Nest] 14332  - [39m07.12.2025, 11:38:09 [31m  ERROR[39m [38;5;3m[TelegramBotService] [39m[31m╨Ю╤И╨╕╨▒╨║╨░ ╨┐╤А╨╕ ╨╖╨░╨┐╤Г╤Б╨║╨╡ ╨▒╨╛╤В╨░: 404: Not Found[39m
Error: 404: Not Found
    at Telegram.callApi (D:\GitHub\Afrodita\backend\node_modules\telegraf\lib\core\network\client.js:315:19)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Telegraf.launch (D:\GitHub\Afrodita\backend\node_modules\telegraf\lib\telegraf.js:188:78)
    at TelegramBotService.onModuleInit (D:\GitHub\Afrodita\backend\src\modules\telegram\telegram-bot.service.ts:116:7)
    at Object.<anonymous> (D:\GitHub\Afrodita\backend\src\modules\telegram\telegram-bot.service.spec.ts:208:7)
PASS src/modules/notifications/notifications.controller.spec.ts (9.113 s)
PASS src/modules/appointments/appointments.controller.spec.ts (9.194 s)
[31m[Nest] 14332  - [39m07.12.2025, 11:38:09 [31m  ERROR[39m [38;5;3m[TelegramBotService] [39m[31m╨Ю╤И╨╕╨▒╨║╨░ ╨┐╤А╨╕ ╨╛╤В╨┐╤А╨░╨▓╨║╨╡ ╤Б╨╛╨╛╨▒╤Й╨╡╨╜╨╕╤П: Send failed[39m
PASS src/modules/telegram/telegram-bot.service.spec.ts (9.24 s)
PASS src/modules/templates/templates.controller.spec.ts
FAIL src/modules/auth/auth.service.spec.ts
  тЧП AuthService тА║ validateTelegramAuth тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨╛╨▒╨╜╨╛╨▓╨╕╤В╤М ╤Б╤Г╤Й╨╡╤Б╤В╨▓╤Г╤О╤Й╨╡╨│╨╛ ╨┐╨╛╨╗╤М╨╖╨╛╨▓╨░╤В╨╡╨╗╤П

    Nest could not find AuthService element (this provider does not exist in the current context)

    [0m [90m 92 |[39m     })[33m.[39mcompile()[33m;[39m
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m     service [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mAuthService[39m[33m>[39m([33mAuthService[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 95 |[39m     userRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mUser[39m[33m>>[39m(getRepositoryToken([33mUser[39m))[33m;[39m
     [90m 96 |[39m     sessionRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mSession[39m[33m>>[39m(getRepositoryToken([33mSession[39m))[33m;[39m
     [90m 97 |[39m     jwtService [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mJwtService[39m[33m>[39m([33mJwtService[39m)[33m;[39m[0m

      at InstanceLinksHost.get (../node_modules/@nestjs/core/injector/instance-links-host.js:15:19)
      at TestingModule.find (../node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)
      at TestingModule.get (../node_modules/@nestjs/core/nest-application-context.js:70:20)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:94:22)

  тЧП AuthService тА║ refreshToken тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨╛╨▒╨╜╨╛╨▓╨╕╤В╤М ╤В╨╛╨║╨╡╨╜╤Л

    Nest could not find AuthService element (this provider does not exist in the current context)

    [0m [90m 92 |[39m     })[33m.[39mcompile()[33m;[39m
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m     service [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mAuthService[39m[33m>[39m([33mAuthService[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 95 |[39m     userRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mUser[39m[33m>>[39m(getRepositoryToken([33mUser[39m))[33m;[39m
     [90m 96 |[39m     sessionRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mSession[39m[33m>>[39m(getRepositoryToken([33mSession[39m))[33m;[39m
     [90m 97 |[39m     jwtService [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mJwtService[39m[33m>[39m([33mJwtService[39m)[33m;[39m[0m

      at InstanceLinksHost.get (../node_modules/@nestjs/core/injector/instance-links-host.js:15:19)
      at TestingModule.find (../node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)
      at TestingModule.get (../node_modules/@nestjs/core/nest-application-context.js:70:20)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:94:22)

  тЧП AuthService тА║ refreshToken тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨▓╤Л╨▒╤А╨╛╤Б╨╕╤В╤М ╨╛╤И╨╕╨▒╨║╤Г ╨╡╤Б╨╗╨╕ ╤Б╨╡╤Б╤Б╨╕╤П ╨╜╨╡ ╨╜╨░╨╣╨┤╨╡╨╜╨░

    Nest could not find AuthService element (this provider does not exist in the current context)

    [0m [90m 92 |[39m     })[33m.[39mcompile()[33m;[39m
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m     service [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mAuthService[39m[33m>[39m([33mAuthService[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 95 |[39m     userRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mUser[39m[33m>>[39m(getRepositoryToken([33mUser[39m))[33m;[39m
     [90m 96 |[39m     sessionRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mSession[39m[33m>>[39m(getRepositoryToken([33mSession[39m))[33m;[39m
     [90m 97 |[39m     jwtService [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mJwtService[39m[33m>[39m([33mJwtService[39m)[33m;[39m[0m

      at InstanceLinksHost.get (../node_modules/@nestjs/core/injector/instance-links-host.js:15:19)
      at TestingModule.find (../node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)
      at TestingModule.get (../node_modules/@nestjs/core/nest-application-context.js:70:20)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:94:22)

  тЧП AuthService тА║ refreshToken тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨▓╤Л╨▒╤А╨╛╤Б╨╕╤В╤М ╨╛╤И╨╕╨▒╨║╤Г ╨╡╤Б╨╗╨╕ ╤Б╨╡╤Б╤Б╨╕╤П ╨╕╤Б╤В╨╡╨║╨╗╨░

    Nest could not find AuthService element (this provider does not exist in the current context)

    [0m [90m 92 |[39m     })[33m.[39mcompile()[33m;[39m
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m     service [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mAuthService[39m[33m>[39m([33mAuthService[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 95 |[39m     userRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mUser[39m[33m>>[39m(getRepositoryToken([33mUser[39m))[33m;[39m
     [90m 96 |[39m     sessionRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mSession[39m[33m>>[39m(getRepositoryToken([33mSession[39m))[33m;[39m
     [90m 97 |[39m     jwtService [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mJwtService[39m[33m>[39m([33mJwtService[39m)[33m;[39m[0m

      at InstanceLinksHost.get (../node_modules/@nestjs/core/injector/instance-links-host.js:15:19)
      at TestingModule.find (../node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)
      at TestingModule.get (../node_modules/@nestjs/core/nest-application-context.js:70:20)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:94:22)

  тЧП AuthService тА║ validatePhone тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨▓╨╡╤А╨╜╤Г╤В╤М true ╨┤╨╗╤П ╨▓╨░╨╗╨╕╨┤╨╜╨╛╨│╨╛ ╤В╨╡╨╗╨╡╤Д╨╛╨╜╨░

    Nest could not find AuthService element (this provider does not exist in the current context)

    [0m [90m 92 |[39m     })[33m.[39mcompile()[33m;[39m
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m     service [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mAuthService[39m[33m>[39m([33mAuthService[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 95 |[39m     userRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mUser[39m[33m>>[39m(getRepositoryToken([33mUser[39m))[33m;[39m
     [90m 96 |[39m     sessionRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mSession[39m[33m>>[39m(getRepositoryToken([33mSession[39m))[33m;[39m
     [90m 97 |[39m     jwtService [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mJwtService[39m[33m>[39m([33mJwtService[39m)[33m;[39m[0m

      at InstanceLinksHost.get (../node_modules/@nestjs/core/injector/instance-links-host.js:15:19)
      at TestingModule.find (../node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)
      at TestingModule.get (../node_modules/@nestjs/core/nest-application-context.js:70:20)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:94:22)

  тЧП AuthService тА║ validatePhone тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨▓╨╡╤А╨╜╤Г╤В╤М false ╨┤╨╗╤П ╨╜╨╡╨▓╨░╨╗╨╕╨┤╨╜╨╛╨│╨╛ ╤В╨╡╨╗╨╡╤Д╨╛╨╜╨░

    Nest could not find AuthService element (this provider does not exist in the current context)

    [0m [90m 92 |[39m     })[33m.[39mcompile()[33m;[39m
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m     service [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mAuthService[39m[33m>[39m([33mAuthService[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 95 |[39m     userRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mUser[39m[33m>>[39m(getRepositoryToken([33mUser[39m))[33m;[39m
     [90m 96 |[39m     sessionRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mSession[39m[33m>>[39m(getRepositoryToken([33mSession[39m))[33m;[39m
     [90m 97 |[39m     jwtService [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mJwtService[39m[33m>[39m([33mJwtService[39m)[33m;[39m[0m

      at InstanceLinksHost.get (../node_modules/@nestjs/core/injector/instance-links-host.js:15:19)
      at TestingModule.find (../node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)
      at TestingModule.get (../node_modules/@nestjs/core/nest-application-context.js:70:20)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:94:22)

  тЧП AuthService тА║ updatePhone тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨╛╨▒╨╜╨╛╨▓╨╕╤В╤М ╤В╨╡╨╗╨╡╤Д╨╛╨╜ ╨┐╨╛╨╗╤М╨╖╨╛╨▓╨░╤В╨╡╨╗╤П

    Nest could not find AuthService element (this provider does not exist in the current context)

    [0m [90m 92 |[39m     })[33m.[39mcompile()[33m;[39m
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m     service [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mAuthService[39m[33m>[39m([33mAuthService[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 95 |[39m     userRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mUser[39m[33m>>[39m(getRepositoryToken([33mUser[39m))[33m;[39m
     [90m 96 |[39m     sessionRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mSession[39m[33m>>[39m(getRepositoryToken([33mSession[39m))[33m;[39m
     [90m 97 |[39m     jwtService [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mJwtService[39m[33m>[39m([33mJwtService[39m)[33m;[39m[0m

      at InstanceLinksHost.get (../node_modules/@nestjs/core/injector/instance-links-host.js:15:19)
      at TestingModule.find (../node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)
      at TestingModule.get (../node_modules/@nestjs/core/nest-application-context.js:70:20)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:94:22)

  тЧП AuthService тА║ updatePhone тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨▓╤Л╨▒╤А╨╛╤Б╨╕╤В╤М ╨╛╤И╨╕╨▒╨║╤Г ╨┤╨╗╤П ╨╜╨╡╨▓╨░╨╗╨╕╨┤╨╜╨╛╨│╨╛ ╤В╨╡╨╗╨╡╤Д╨╛╨╜╨░

    Nest could not find AuthService element (this provider does not exist in the current context)

    [0m [90m 92 |[39m     })[33m.[39mcompile()[33m;[39m
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m     service [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mAuthService[39m[33m>[39m([33mAuthService[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 95 |[39m     userRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mUser[39m[33m>>[39m(getRepositoryToken([33mUser[39m))[33m;[39m
     [90m 96 |[39m     sessionRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mSession[39m[33m>>[39m(getRepositoryToken([33mSession[39m))[33m;[39m
     [90m 97 |[39m     jwtService [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mJwtService[39m[33m>[39m([33mJwtService[39m)[33m;[39m[0m

      at InstanceLinksHost.get (../node_modules/@nestjs/core/injector/instance-links-host.js:15:19)
      at TestingModule.find (../node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)
      at TestingModule.get (../node_modules/@nestjs/core/nest-application-context.js:70:20)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:94:22)

  тЧП AuthService тА║ updatePhone тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨▓╤Л╨▒╤А╨╛╤Б╨╕╤В╤М ╨╛╤И╨╕╨▒╨║╤Г ╨╡╤Б╨╗╨╕ ╨┐╨╛╨╗╤М╨╖╨╛╨▓╨░╤В╨╡╨╗╤М ╨╜╨╡ ╨╜╨░╨╣╨┤╨╡╨╜

    Nest could not find AuthService element (this provider does not exist in the current context)

    [0m [90m 92 |[39m     })[33m.[39mcompile()[33m;[39m
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m     service [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mAuthService[39m[33m>[39m([33mAuthService[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 95 |[39m     userRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mUser[39m[33m>>[39m(getRepositoryToken([33mUser[39m))[33m;[39m
     [90m 96 |[39m     sessionRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mSession[39m[33m>>[39m(getRepositoryToken([33mSession[39m))[33m;[39m
     [90m 97 |[39m     jwtService [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mJwtService[39m[33m>[39m([33mJwtService[39m)[33m;[39m[0m

      at InstanceLinksHost.get (../node_modules/@nestjs/core/injector/instance-links-host.js:15:19)
      at TestingModule.find (../node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)
      at TestingModule.get (../node_modules/@nestjs/core/nest-application-context.js:70:20)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:94:22)

PASS src/modules/financial/financial.controller.spec.ts
PASS src/modules/auth/strategies/jwt.strategy.spec.ts
PASS src/modules/reviews/reviews.controller.spec.ts
PASS src/modules/services/services.controller.spec.ts
PASS src/modules/telegram/telegram.service.spec.ts
PASS src/modules/telegram/telegram-chats.service.spec.ts
PASS src/modules/settings/settings.controller.spec.ts
PASS src/modules/masters/masters.service.spec.ts
PASS src/modules/users/users.controller.spec.ts
PASS src/modules/analytics/analytics.controller.spec.ts
PASS src/modules/services/services.service.spec.ts
PASS src/modules/templates/templates.service.spec.ts
PASS src/modules/audit/audit.controller.spec.ts
PASS src/modules/financial/financial.service.spec.ts
PASS src/modules/auth/guards/roles.guard.spec.ts
PASS src/modules/reviews/reviews.service.spec.ts
PASS src/modules/notifications/notifications.service.spec.ts
PASS src/modules/settings/settings.service.spec.ts
PASS src/modules/analytics/analytics.service.spec.ts
PASS src/modules/audit/audit.service.spec.ts

Summary of all failing tests
FAIL modules/users/users.service.spec.ts (8.02 s)
  тЧП UsersService тА║ findAll - edge cases тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╤Д╨╕╨╗╤М╤В╤А╨╛╨▓╨░╤В╤М ╨┐╨╛╨╗╤М╨╖╨╛╨▓╨░╤В╨╡╨╗╨╡╨╣ ╨┐╨╛ search

    TypeError: query.andWhere is not a function

    [0m [90m 26 |[39m     }
     [90m 27 |[39m     [36mif[39m (search) {
    [31m[1m>[22m[39m[90m 28 |[39m       query[33m.[39mandWhere(
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m         [32m'(user.firstName ILIKE :search OR user.lastName ILIKE :search OR user.phone ILIKE :search OR user.email ILIKE :search)'[39m[33m,[39m
     [90m 30 |[39m         { search[33m:[39m [32m`%${search}%`[39m }[33m,[39m
     [90m 31 |[39m       )[33m;[39m[0m

      at UsersService.findAll (modules/users/users.service.ts:28:13)
      at Object.<anonymous> (modules/users/users.service.spec.ts:374:21)

  тЧП UsersService тА║ findAll - edge cases тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╤Д╨╕╨╗╤М╤В╤А╨╛╨▓╨░╤В╤М ╨┐╨╛╨╗╤М╨╖╨╛╨▓╨░╤В╨╡╨╗╨╡╨╣ ╨┐╨╛ isActive

    TypeError: query.getCount is not a function

    [0m [90m 33 |[39m     query[33m.[39morderBy([32m'user.createdAt'[39m[33m,[39m [32m'DESC'[39m)[33m;[39m
     [90m 34 |[39m
    [31m[1m>[22m[39m[90m 35 |[39m     [36mconst[39m total [33m=[39m [36mawait[39m query[33m.[39mgetCount()[33m;[39m
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 36 |[39m     [36mconst[39m skip [33m=[39m (page [33m-[39m [35m1[39m) [33m*[39m limit[33m;[39m
     [90m 37 |[39m     query[33m.[39mskip(skip)[33m.[39mtake(limit)[33m;[39m
     [90m 38 |[39m[0m

      at UsersService.findAll (modules/users/users.service.ts:35:31)
      at Object.<anonymous> (modules/users/users.service.spec.ts:390:21)

FAIL modules/auth/auth.service.spec.ts
  тЧП AuthService тА║ validateTelegramAuth тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨╛╨▒╨╜╨╛╨▓╨╕╤В╤М ╤Б╤Г╤Й╨╡╤Б╤В╨▓╤Г╤О╤Й╨╡╨│╨╛ ╨┐╨╛╨╗╤М╨╖╨╛╨▓╨░╤В╨╡╨╗╤П

    Nest could not find AuthService element (this provider does not exist in the current context)

    [0m [90m 92 |[39m     })[33m.[39mcompile()[33m;[39m
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m     service [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mAuthService[39m[33m>[39m([33mAuthService[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 95 |[39m     userRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mUser[39m[33m>>[39m(getRepositoryToken([33mUser[39m))[33m;[39m
     [90m 96 |[39m     sessionRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mSession[39m[33m>>[39m(getRepositoryToken([33mSession[39m))[33m;[39m
     [90m 97 |[39m     jwtService [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mJwtService[39m[33m>[39m([33mJwtService[39m)[33m;[39m[0m

      at InstanceLinksHost.get (../node_modules/@nestjs/core/injector/instance-links-host.js:15:19)
      at TestingModule.find (../node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)
      at TestingModule.get (../node_modules/@nestjs/core/nest-application-context.js:70:20)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:94:22)

  тЧП AuthService тА║ refreshToken тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨╛╨▒╨╜╨╛╨▓╨╕╤В╤М ╤В╨╛╨║╨╡╨╜╤Л

    Nest could not find AuthService element (this provider does not exist in the current context)

    [0m [90m 92 |[39m     })[33m.[39mcompile()[33m;[39m
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m     service [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mAuthService[39m[33m>[39m([33mAuthService[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 95 |[39m     userRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mUser[39m[33m>>[39m(getRepositoryToken([33mUser[39m))[33m;[39m
     [90m 96 |[39m     sessionRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mSession[39m[33m>>[39m(getRepositoryToken([33mSession[39m))[33m;[39m
     [90m 97 |[39m     jwtService [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mJwtService[39m[33m>[39m([33mJwtService[39m)[33m;[39m[0m

      at InstanceLinksHost.get (../node_modules/@nestjs/core/injector/instance-links-host.js:15:19)
      at TestingModule.find (../node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)
      at TestingModule.get (../node_modules/@nestjs/core/nest-application-context.js:70:20)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:94:22)

  тЧП AuthService тА║ refreshToken тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨▓╤Л╨▒╤А╨╛╤Б╨╕╤В╤М ╨╛╤И╨╕╨▒╨║╤Г ╨╡╤Б╨╗╨╕ ╤Б╨╡╤Б╤Б╨╕╤П ╨╜╨╡ ╨╜╨░╨╣╨┤╨╡╨╜╨░

    Nest could not find AuthService element (this provider does not exist in the current context)

    [0m [90m 92 |[39m     })[33m.[39mcompile()[33m;[39m
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m     service [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mAuthService[39m[33m>[39m([33mAuthService[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 95 |[39m     userRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mUser[39m[33m>>[39m(getRepositoryToken([33mUser[39m))[33m;[39m
     [90m 96 |[39m     sessionRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mSession[39m[33m>>[39m(getRepositoryToken([33mSession[39m))[33m;[39m
     [90m 97 |[39m     jwtService [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mJwtService[39m[33m>[39m([33mJwtService[39m)[33m;[39m[0m

      at InstanceLinksHost.get (../node_modules/@nestjs/core/injector/instance-links-host.js:15:19)
      at TestingModule.find (../node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)
      at TestingModule.get (../node_modules/@nestjs/core/nest-application-context.js:70:20)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:94:22)

  тЧП AuthService тА║ refreshToken тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨▓╤Л╨▒╤А╨╛╤Б╨╕╤В╤М ╨╛╤И╨╕╨▒╨║╤Г ╨╡╤Б╨╗╨╕ ╤Б╨╡╤Б╤Б╨╕╤П ╨╕╤Б╤В╨╡╨║╨╗╨░

    Nest could not find AuthService element (this provider does not exist in the current context)

    [0m [90m 92 |[39m     })[33m.[39mcompile()[33m;[39m
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m     service [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mAuthService[39m[33m>[39m([33mAuthService[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 95 |[39m     userRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mUser[39m[33m>>[39m(getRepositoryToken([33mUser[39m))[33m;[39m
     [90m 96 |[39m     sessionRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mSession[39m[33m>>[39m(getRepositoryToken([33mSession[39m))[33m;[39m
     [90m 97 |[39m     jwtService [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mJwtService[39m[33m>[39m([33mJwtService[39m)[33m;[39m[0m

      at InstanceLinksHost.get (../node_modules/@nestjs/core/injector/instance-links-host.js:15:19)
      at TestingModule.find (../node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)
      at TestingModule.get (../node_modules/@nestjs/core/nest-application-context.js:70:20)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:94:22)

  тЧП AuthService тА║ validatePhone тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨▓╨╡╤А╨╜╤Г╤В╤М true ╨┤╨╗╤П ╨▓╨░╨╗╨╕╨┤╨╜╨╛╨│╨╛ ╤В╨╡╨╗╨╡╤Д╨╛╨╜╨░

    Nest could not find AuthService element (this provider does not exist in the current context)

    [0m [90m 92 |[39m     })[33m.[39mcompile()[33m;[39m
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m     service [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mAuthService[39m[33m>[39m([33mAuthService[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 95 |[39m     userRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mUser[39m[33m>>[39m(getRepositoryToken([33mUser[39m))[33m;[39m
     [90m 96 |[39m     sessionRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mSession[39m[33m>>[39m(getRepositoryToken([33mSession[39m))[33m;[39m
     [90m 97 |[39m     jwtService [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mJwtService[39m[33m>[39m([33mJwtService[39m)[33m;[39m[0m

      at InstanceLinksHost.get (../node_modules/@nestjs/core/injector/instance-links-host.js:15:19)
      at TestingModule.find (../node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)
      at TestingModule.get (../node_modules/@nestjs/core/nest-application-context.js:70:20)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:94:22)

  тЧП AuthService тА║ validatePhone тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨▓╨╡╤А╨╜╤Г╤В╤М false ╨┤╨╗╤П ╨╜╨╡╨▓╨░╨╗╨╕╨┤╨╜╨╛╨│╨╛ ╤В╨╡╨╗╨╡╤Д╨╛╨╜╨░

    Nest could not find AuthService element (this provider does not exist in the current context)

    [0m [90m 92 |[39m     })[33m.[39mcompile()[33m;[39m
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m     service [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mAuthService[39m[33m>[39m([33mAuthService[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 95 |[39m     userRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mUser[39m[33m>>[39m(getRepositoryToken([33mUser[39m))[33m;[39m
     [90m 96 |[39m     sessionRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mSession[39m[33m>>[39m(getRepositoryToken([33mSession[39m))[33m;[39m
     [90m 97 |[39m     jwtService [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mJwtService[39m[33m>[39m([33mJwtService[39m)[33m;[39m[0m

      at InstanceLinksHost.get (../node_modules/@nestjs/core/injector/instance-links-host.js:15:19)
      at TestingModule.find (../node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)
      at TestingModule.get (../node_modules/@nestjs/core/nest-application-context.js:70:20)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:94:22)

  тЧП AuthService тА║ updatePhone тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨╛╨▒╨╜╨╛╨▓╨╕╤В╤М ╤В╨╡╨╗╨╡╤Д╨╛╨╜ ╨┐╨╛╨╗╤М╨╖╨╛╨▓╨░╤В╨╡╨╗╤П

    Nest could not find AuthService element (this provider does not exist in the current context)

    [0m [90m 92 |[39m     })[33m.[39mcompile()[33m;[39m
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m     service [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mAuthService[39m[33m>[39m([33mAuthService[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 95 |[39m     userRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mUser[39m[33m>>[39m(getRepositoryToken([33mUser[39m))[33m;[39m
     [90m 96 |[39m     sessionRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mSession[39m[33m>>[39m(getRepositoryToken([33mSession[39m))[33m;[39m
     [90m 97 |[39m     jwtService [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mJwtService[39m[33m>[39m([33mJwtService[39m)[33m;[39m[0m

      at InstanceLinksHost.get (../node_modules/@nestjs/core/injector/instance-links-host.js:15:19)
      at TestingModule.find (../node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)
      at TestingModule.get (../node_modules/@nestjs/core/nest-application-context.js:70:20)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:94:22)

  тЧП AuthService тА║ updatePhone тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨▓╤Л╨▒╤А╨╛╤Б╨╕╤В╤М ╨╛╤И╨╕╨▒╨║╤Г ╨┤╨╗╤П ╨╜╨╡╨▓╨░╨╗╨╕╨┤╨╜╨╛╨│╨╛ ╤В╨╡╨╗╨╡╤Д╨╛╨╜╨░

    Nest could not find AuthService element (this provider does not exist in the current context)

    [0m [90m 92 |[39m     })[33m.[39mcompile()[33m;[39m
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m     service [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mAuthService[39m[33m>[39m([33mAuthService[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 95 |[39m     userRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mUser[39m[33m>>[39m(getRepositoryToken([33mUser[39m))[33m;[39m
     [90m 96 |[39m     sessionRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mSession[39m[33m>>[39m(getRepositoryToken([33mSession[39m))[33m;[39m
     [90m 97 |[39m     jwtService [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mJwtService[39m[33m>[39m([33mJwtService[39m)[33m;[39m[0m

      at InstanceLinksHost.get (../node_modules/@nestjs/core/injector/instance-links-host.js:15:19)
      at TestingModule.find (../node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)
      at TestingModule.get (../node_modules/@nestjs/core/nest-application-context.js:70:20)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:94:22)

  тЧП AuthService тА║ updatePhone тА║ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨▓╤Л╨▒╤А╨╛╤Б╨╕╤В╤М ╨╛╤И╨╕╨▒╨║╤Г ╨╡╤Б╨╗╨╕ ╨┐╨╛╨╗╤М╨╖╨╛╨▓╨░╤В╨╡╨╗╤М ╨╜╨╡ ╨╜╨░╨╣╨┤╨╡╨╜

    Nest could not find AuthService element (this provider does not exist in the current context)

    [0m [90m 92 |[39m     })[33m.[39mcompile()[33m;[39m
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m     service [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mAuthService[39m[33m>[39m([33mAuthService[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 95 |[39m     userRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mUser[39m[33m>>[39m(getRepositoryToken([33mUser[39m))[33m;[39m
     [90m 96 |[39m     sessionRepository [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mRepository[39m[33m<[39m[33mSession[39m[33m>>[39m(getRepositoryToken([33mSession[39m))[33m;[39m
     [90m 97 |[39m     jwtService [33m=[39m module[33m.[39m[36mget[39m[33m<[39m[33mJwtService[39m[33m>[39m([33mJwtService[39m)[33m;[39m[0m

      at InstanceLinksHost.get (../node_modules/@nestjs/core/injector/instance-links-host.js:15:19)
      at TestingModule.find (../node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)
      at TestingModule.get (../node_modules/@nestjs/core/nest-application-context.js:70:20)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:94:22)


Test Suites: 2 failed, 28 passed, 30 total
Tests:       11 failed, 317 passed, 328 total
Snapshots:   0 total
Time:        12.092 s, estimated 19 s
Ran all test suites.
